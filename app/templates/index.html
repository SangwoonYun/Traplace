<!-- File: app/templates/index.html -->
<!doctype html>
<html lang="en">
  <head>
    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', 'GTM-M2J65D6M');
    </script>
    <!-- End Google Tag Manager -->

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <title>Kingshot Traplace</title>

    <!-- Icons & Styles -->
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/grid.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/blocks.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ui.css') }}" />
  </head>

  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-M2J65D6M"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe
    ></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!-- Sidebar: palette only (footer removed by convention) -->
    <aside id="sidebar" class="sidebar">
      <!-- Hidden on mobile: usage block -->
      <div class="usage-section" data-mobile-hidden>
        <button id="usageToggle" class="usage-toggle" type="button" aria-expanded="false">
          <h2 data-i18n="ui.usageTitle">How to use</h2>
          <span class="toggle-icon" aria-hidden="true">â–¼</span>
        </button>
        <div id="usageContent" class="usage-content collapsed">
          <div class="usage" data-i18n="ui.usage"></div>
        </div>
      </div>

      <!-- Hidden on mobile: palette title -->
      <div class="palette-title" data-i18n="ui.paletteTitle" data-mobile-hidden>Palette</div>

      <!-- Palette -->
      <div
        id="palette"
        class="palette palette--scroll"
        role="listbox"
        tabindex="0"
        aria-label="Palette"
      >
        <div
          class="palette-item"
          data-kind="hq"
          data-size="3"
          role="button"
          tabindex="0"
          aria-label="HQ"
        >
          <div class="pi-rot"></div>
          <span class="pi-text">HQ</span>
        </div>

        <div
          class="palette-item"
          data-kind="flag"
          data-size="1"
          role="button"
          tabindex="0"
          aria-label="Banner"
        >
          <div class="pi-rot"></div>
          <span class="pi-text">Banner</span>
        </div>

        <div
          class="palette-item"
          data-kind="trap"
          data-size="3"
          role="button"
          tabindex="0"
          aria-label="Hunting Trap"
        >
          <div class="pi-rot"></div>
          <span class="pi-text">Hunting Trap</span>
        </div>

        <div
          class="palette-item"
          data-kind="city"
          data-size="2"
          role="button"
          tabindex="0"
          aria-label="Town"
        >
          <div class="pi-rot"></div>
          <span class="pi-text">Town</span>
        </div>

        <div
          class="palette-item"
          data-kind="resource"
          data-size="2"
          role="button"
          tabindex="0"
          aria-label="Resource"
        >
          <div class="pi-rot"></div>
          <span class="pi-text">Resource</span>
        </div>

        <div
          class="palette-item palette-item-custom"
          data-kind="custom"
          role="button"
          tabindex="0"
          aria-label="Custom Block"
        >
          <div class="pi-rot"></div>
          <span class="pi-text">Custom</span>
          <div class="custom-inputs">
            <input
              type="number"
              class="custom-width"
              placeholder="X"
              min="1"
              max="30"
              value="1"
              aria-label="Width"
            />
            <span class="custom-separator">Ã—</span>
            <input
              type="number"
              class="custom-height"
              placeholder="Y"
              min="1"
              max="30"
              value="1"
              aria-label="Height"
            />
          </div>
        </div>
      </div>

      <!-- Remote Control -->
      <div class="remote-control">
        <button class="remote-btn remote-btn-tl" type="button" aria-label="Move top-left">â†–</button>
        <button class="remote-btn remote-btn-tr" type="button" aria-label="Move top-right">â†—</button>
        <button class="remote-btn remote-btn-bl" type="button" aria-label="Move bottom-left">â†™</button>
        <button class="remote-btn remote-btn-br" type="button" aria-label="Move bottom-right">â†˜</button>
      </div>

      <div class="sidebar-footer">
        <!-- QR ì½”ë“œ 2ê°œ -->
        <div class="footer-qrs">
          <div class="qr-item">
            <a
              class="qr-link"
              href="https://www.buymeacoffee.com/swyun"
              target="_blank"
              rel="noopener noreferrer"
              title="Buy me a coffee"
            >
              <img
                class="qr-img"
                src="{{ url_for('static', filename='img/qr-code-bmc.png') }}"
                alt="Buy me a coffee QR"
              />
            </a>
            <span class="qr-label">Buy me a coffee</span>
          </div>

          <div class="qr-item">
            <a
              class="qr-link"
              href="supertoss://send?amount=0&bank=IBK%EA%B8%B0%EC%97%85%EC%9D%80%ED%96%89&accountNo=29810334201018&origin=qr"
              target="_blank"
              rel="noopener noreferrer"
              title="í† ìŠ¤ ì†¡ê¸ˆ"
            >
              <img
                class="qr-img"
                src="{{ url_for('static', filename='img/qr-code-toss.jpg') }}"
                alt="Toss QR"
              />
            </a>
            <span class="qr-label">Toss</span>
          </div>
        </div>

        <!-- GitHub + í¬ë ˆë”§ -->
        <div class="footer-info">
          <a
            class="github-link"
            href="https://github.com/SangwoonYun/Traplace"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="Traplace GitHub"
          >
            <img
              class="github-icon"
              src="{{ url_for('static', filename='img/github-mark.svg') }}"
              alt="GitHub"
            />
          </a>
          <span class="credit">Created by #159 [TCA] ë°©êµ¬ì„ê°œë°œì</span>
        </div>

        <!-- Legal Links -->
        <div class="footer-legal">
          <a
            href="{{ url_for('policies.privacy') }}?lang={{ current_lang or 'ko' }}"
            class="legal-link"
            data-i18n="ui.footer.privacy"
            >Privacy Policy</a
          >
          <span class="legal-sep">â€¢</span>
          <a
            href="{{ url_for('policies.terms') }}?lang={{ current_lang or 'ko' }}"
            class="legal-link"
            data-i18n="ui.footer.terms"
            >Terms of Service</a
          >
        </div>
      </div>
    </aside>

    <!-- Top toolbar -->
    <header id="toolbar" class="toolbar" role="toolbar" aria-label="Editor toolbar">
      <div class="tb-group">
        <button
          id="btnUndo"
          class="tb-btn"
          type="button"
          title="Undo (âŒ˜Z / Ctrl+Z)"
          aria-label="Undo"
        >
          â†¶
        </button>
        <button
          id="btnRedo"
          class="tb-btn"
          type="button"
          title="Redo (â‡§âŒ˜Z / Ctrl+Y)"
          aria-label="Redo"
        >
          â†·
        </button>
      </div>

      <div class="tb-sep" aria-hidden="true"></div>

      <div class="tb-group">
        <button
          id="btnCityTrapDist"
          class="tb-btn"
          type="button"
          title="Measure move time (âŒ¥âŒ˜D / Ctrl+Alt+D)"
          aria-label="Measure move time"
        >
          ğŸ“
        </button>
        <button
          id="btnReset"
          class="tb-btn danger"
          type="button"
          title="Reset (âŒ¥âŒ˜R / Ctrl+Alt+R)"
          aria-label="Reset"
        >
          ğŸ§¹
        </button>
        <button
          id="btnCopyURL"
          class="tb-btn"
          type="button"
          title="Copy URL (âŒ¥âŒ˜C / Ctrl+Alt+C)"
          aria-label="Copy URL"
        >
          ğŸ”—
        </button>
        <button
          id="btnExportPNG"
          class="tb-btn primary"
          type="button"
          title="Export PNG (âŒ¥âŒ˜E / Ctrl+Alt+E)"
          aria-label="Export PNG"
        >
          ğŸ–¼
        </button>
        <button
          id="btnImportPNG"
          class="tb-btn primary"
          type="button"
          title="Import PNG (âŒ¥âŒ˜I / Ctrl+Alt+I)"
          aria-label="Import PNG"
        >
          ğŸ“¥
        </button>
        <input
          id="pngFileInput"
          type="file"
          accept="image/png"
          style="display: none;"
          aria-hidden="true"
        />
      </div>

      <div class="tb-flex-spacer" aria-hidden="true"></div>

      <div class="tb-group">
        <label class="lang-label" for="langSelect" data-i18n="ui.toolbar.lang">Language</label>
        <select id="langSelect" class="lang-select" aria-label="Language">
          <option value="en">ğŸ‡ºğŸ‡¸ English</option>
          <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
          <option value="zh-CN">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
          <option value="zh-TW">ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡</option>
          <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
          <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
          <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
          <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
          <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
          <option value="pl">ğŸ‡µğŸ‡± Polski</option>
          <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
          <option value="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
          <!-- <option value="ar" data-rtl>ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option> -->
          <option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
          <option value="id">ğŸ‡®ğŸ‡© Indonesia</option>
        </select>
      </div>
    </header>

    <!-- Viewport / World -->
    <main id="viewport" class="viewport" aria-label="scrollable-viewport">
      <div id="world" class="world">
        <div id="rot" class="rot">
          <div class="grid"></div>
          <div id="tilesRedZone" class="tiles-redzone"></div>
          <div id="tiles" class="tiles"></div>
          <div id="tilesUser" class="tiles-user"></div>
          <div id="tilesPreview" class="tiles-preview"></div>
          <div id="outlines" class="outlines"></div>
          <div id="outlinesPreview" class="outlines-preview"></div>
          <div id="snap" class="snap-outline"></div>
        </div>

        <div id="badge" class="badge">
          <button id="btnHome" class="home-btn" type="button" title="Home" aria-label="Home">
            ğŸ 
          </button>
          <button id="btnTrap" class="trap-btn" type="button" title="Find Trap" aria-label="Find Trap">
            ğŸ»
          </button>
          <span id="badgeCoord" class="badge-coord-text" title="Click to jump to coordinates">x:-, y:-</span>
          <input id="badgeInput" class="badge-coord-input" type="text" style="display: none;" placeholder="x, y" />
          <span id="badgeZoom" aria-live="polite">100%</span>
        </div>
      </div>
    </main>

    <!-- Trash zone for delete via drag -->
    <div
      id="trashZone"
      class="trash-zone"
      data-i18n-title="ui.trash.title"
      title="Drag here to delete"
    >
      <span class="trash-emoji" aria-hidden="true">ğŸ—‘</span>
      <span class="trash-label" data-i18n="ui.trash.label">Drag here to delete</span>
    </div>

    <!-- URL Copy Modal -->
    <div id="urlModal" class="url-modal" style="display: none;">
      <div class="url-modal-content">
        <div class="url-modal-header">
          <h3 data-i18n="modal.urlCopy.title">Copy URL</h3>
          <button id="urlModalClose" class="url-modal-close" type="button" aria-label="Close">&times;</button>
        </div>
        <div class="url-modal-body">
          <p data-i18n="modal.urlCopy.message">Please copy the URL below.</p>
          <div class="url-display-container">
            <input id="urlDisplayInput" class="url-display-input" type="text" readonly />
          </div>
        </div>
        <div class="url-modal-footer">
          <button id="urlModalCopy" class="url-modal-copy-btn" type="button" data-i18n="modal.urlCopy.copyBtn">Copy</button>
        </div>
      </div>
    </div>

    <noscript>Please enable JavaScript to use this app.</noscript>
    <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>
  </body>
</html>
